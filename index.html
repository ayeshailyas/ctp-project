<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Globe Visualization</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000000;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #fff;
      }

      #canvas-container {
        width: 100vw;
        height: 100vh;
        position: relative;
      }

      /* Control Panel */
      #control-panel {
        position: absolute;
        top: 20px;
        left: 60px;
        background: rgba(20, 20, 40, 0.9);
        padding: 20px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 100;
        max-width: 300px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease;
      }

      #control-panel.collapsed {
        transform: translateX(-400px);
      }

      #toggle-panel {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(20, 20, 40, 0.9);
        border: 1px solid #4ecdc4;
        color: #4ecdc4;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s ease;
        z-index: 102;
        backdrop-filter: blur(10px);
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #toggle-panel:hover {
        background: rgba(78, 205, 196, 0.3);
      }

      #control-panel h2 {
        margin: 0 0 15px 0;
        font-size: 18px;
        color: #4ecdc4;
      }

      .control-group {
        margin-bottom: 15px;
      }

      .control-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 12px;
        color: #aaa;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .control-group input[type="range"] {
        width: 100%;
        accent-color: #4ecdc4;
      }

      .control-group input[type="text"] {
        width: 100%;
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        color: #fff;
        font-size: 14px;
      }

      .control-group input[type="text"]:focus {
        outline: none;
        border-color: #4ecdc4;
      }

      .control-group select {
        width: 100%;
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        color: #fff;
        font-size: 14px;
        cursor: pointer;
      }

      .control-group select:focus {
        outline: none;
        border-color: #4ecdc4;
      }

      .control-group select option {
        background: #1a1a2e;
        color: #fff;
      }

      .filter-section {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 15px;
        margin-top: 15px;
      }

      .filter-section h3 {
        font-size: 14px;
        color: #4ecdc4;
        margin-bottom: 10px;
      }

      .button-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      button {
        padding: 8px 16px;
        background: rgba(78, 205, 196, 0.2);
        border: 1px solid #4ecdc4;
        border-radius: 6px;
        color: #4ecdc4;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s;
        flex: 1;
        min-width: 80px;
      }

      button:hover {
        background: rgba(78, 205, 196, 0.3);
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      button.active {
        background: #4ecdc4;
        color: #0a0e27;
      }

      /* Info Panel */
      #info-panel {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(20, 20, 40, 0.9);
        padding: 20px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 100;
        max-width: 300px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        display: none;
      }

      #info-panel.visible {
        display: block;
      }

      #info-panel h3 {
        margin: 0 0 10px 0;
        font-size: 20px;
        color: #4ecdc4;
      }

      #info-panel p {
        margin: 5px 0;
        font-size: 14px;
        line-height: 1.6;
      }

      #info-panel .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
        min-width: auto;
      }

      /* Tooltip */
      #tooltip {
        position: absolute;
        background: rgba(20, 20, 40, 0.95);
        padding: 10px 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        pointer-events: none;
        z-index: 200;
        display: none;
        font-size: 14px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      /* Stats Display */
      #stats-panel {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(20, 20, 40, 0.9);
        padding: 15px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 100;
        font-size: 12px;
        color: #aaa;
      }

      #stats-panel div {
        margin: 3px 0;
      }

      /* Legend */
      #legend {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(20, 20, 40, 0.9);
        padding: 15px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 100;
        max-width: 250px;
      }

      #legend h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #4ecdc4;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin: 5px 0;
        font-size: 12px;
      }

      .legend-color {
        width: 20px;
        height: 12px;
        margin-right: 8px;
        border-radius: 3px;
      }

      /* Loading */
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(20, 20, 40, 0.9);
        padding: 30px 40px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 300;
        text-align: center;
      }

      .spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid #4ecdc4;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Search Results */
      #search-results {
        position: absolute;
        top: 145px;
        left: 20px;
        background: rgba(20, 20, 40, 0.95);
        border-radius: 8px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 101;
        max-width: 300px;
        max-height: 300px;
        overflow-y: auto;
        display: none;
      }

      .search-result-item {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.2s;
      }

      .search-result-item:hover {
        background: rgba(78, 205, 196, 0.1);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }
    </style>
    <link rel="stylesheet" href="chatbot/chatbot.css" />
  </head>
  <body>
    <div id="canvas-container"></div>

    <!-- Loading Screen -->
    <div id="loading">
      <div class="spinner"></div>
      <div>Loading Globe Data...</div>
    </div>

    <!-- Control Panel -->
    <div id="control-panel" class="collapsed">
      <h2>üåç Globe Controls</h2>

      <div class="control-group">
        <label>Search Country</label>
        <input
          type="text"
          id="country-search"
          placeholder="Type country name..."
        />
      </div>

      <div id="search-results"></div>

      <div class="control-group">
        <label>Rotation Speed: <span id="speed-value">0.1x</span></label>
        <input
          type="range"
          id="rotation-speed"
          min="0"
          max="5"
          step="0.1"
          value="0.1"
        />
      </div>

      <div class="control-group button-group">
        <button id="toggle-rotation" class="active">Auto-Rotate</button>
        <button id="reset-view">Reset View</button>
      </div>

      <div class="control-group button-group">
        <button id="toggle-markers">Markers</button>
        <button id="toggle-connections">Connections</button>
      </div>

      <div class="control-group button-group">
        <button
          id="globe-view-button"
          onclick="window.location.href='http://localhost:8000/subfields.html'"
        >
          üìä Graph View
        </button>
        <button id="toggle-atmosphere">Atmosphere</button>
      </div>
    </div>

    <!-- Toggle Button (outside panel) -->
    <button id="toggle-panel">‚ò∞</button>

    <!-- Info Panel / Research Data Filters -->
    <div id="info-panel">
      <button class="close-btn" id="close-info">√ó</button>
      <h3 id="country-name">Country Name</h3>

      <div class="filter-section">
        <h3>Research Data Filters</h3>

        <div class="control-group">
          <label>Field</label>
          <select id="field-filter">
            <option value="">Choose Field</option>
          </select>
        </div>

        <div class="control-group">
          <label>Subfield</label>
          <select id="subfield-filter" disabled>
            <option value="">Choose Subfield</option>
          </select>
        </div>

        <div class="control-group">
          <label>Funder</label>
          <select id="funder-filter" disabled>
            <option value="">Choose Funder</option>
          </select>
        </div>

        <div class="control-group">
          <label>Topic</label>
          <select id="topic-filter" disabled>
            <option value="">Choose Topic</option>
          </select>
        </div>

        <div class="control-group button-group">
          <button id="apply-filters">Apply Filters</button>
          <button id="clear-filters">Clear All</button>
        </div>
      </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip"></div>

    <!-- Stats Panel -->
    <div id="stats-panel">
      <div>FPS: <span id="fps">0</span></div>
      <div>Countries: <span id="country-count">0</span></div>
      <div>Markers: <span id="marker-count">0</span></div>
    </div>

    <!-- Legend -->
    <div id="legend">
      <h4>Legend</h4>
      <div class="legend-item">
        <div class="legend-color" style="background: #4ecdc4"></div>
        <span>Markers</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #ff6b6b"></div>
        <span>Connections</span>
      </div>
      <div class="legend-item">
        <div
          class="legend-color"
          style="background: rgba(255, 255, 255, 0.3)"
        ></div>
        <span>Country Borders</span>
      </div>
      <div
        class="legend-item"
        id="research-legend-subfield"
        style="display: none"
      >
        <div class="legend-color" style="background: #ffd700"></div>
        <span>Subfields</span>
      </div>
      <div class="legend-item" id="research-legend-topic" style="display: none">
        <div class="legend-color" style="background: #ff69b4"></div>
        <span>Topics</span>
      </div>
      <div
        class="legend-item"
        id="research-legend-funder"
        style="display: none"
      >
        <div class="legend-color" style="background: #00ffff"></div>
        <span>Funders</span>
      </div>
    </div>

    <!-- Chatbot Container -->
    <div id="chatbot-container"></div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
      }
    </script>
    <script type="module" src="globe.js"></script>
    <script src="chatbot/chatbot.js"></script>
  </body>
</html>
